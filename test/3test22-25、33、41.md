# 微芯区块链委托测试归档

## 22 新增节点的稳定性

1. 启动7节点双链，其中chain1有5节点，chain2有7节点

2. 持续请求链信息

   ```sh
   ./loop-chaininfo.sh
   ```

3. 启动节点8

   

4. 在节点8发起创建合约的请求

   ```sh
   ./cmc client contract user create --admin-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.key --admin-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.crt  --org-id=wx-org1.chainmaker.org --chain-id=chain1 --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --byte-code-path=../../test/wasm/asset-rust-0.7.2.wasm --contract-name=asset_new22 --runtime-type=WASMER --sdk-conf-path=../sdk/testdata/sdk_config_bc1_node8.yml --version=1.0 --sync-result=true --params="{\"issue_limit\":\"1000\",\"total_supply\":\"100000000\"}"
   ```

5. 检查第2步持续请求链信息的请求应为成功

## 23 删除节点的稳定性

1. 启动7节点双链，其中chain1有5节点，chain2有7节点

2. 持续请求链信息

   ```sh
   ./loop-chaininfo.sh
   ```

3. 节点7停止共识

   ./stop.sh

4. 检查第步所有请求均成功

## 24 升级节点的稳定性

1. 启动7节点双链，其中chain1有5节点，chain2有7节点

2. 持续请求链信息

   ```sh
   ./loop-chaininfo.sh
   ```

3. 将所有节点软件升逐步级至0.7.2.1，升级步骤如下

   1. 停止节点服务
   2. go build -o chainmaker
   3. mv chainmaker ../build/release/chainmaker-V1.0.0-wx-org(x).chainmaker.org/bin/，注意(x用具体的要升级的节点编号代替)

4. 检查第2步所有请求均成功

## 25 修改节点配置的稳定性*

1. 启动7节点双链，其中chain1有5节点，chain2有7节点

2. 持续请求链信息

   ```sh
   cd tools/cmc
   ./loop-chaininfo.sh > loop.txt
   ```

3. 修改链配置出块间隔为2秒

   ```sh
   ./cmc client chainconfig block updateblockinterval --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --sdk-conf-path=../sdk/testdata/sdk_config.yml --admin-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.crt --admin-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.key --block-interval 2000
   ```

4. 检查第2步所有请求均成功

## 33 节点灾备方案*

1. 启动7节点双链，其中chain1有5节点，chain2有7节点

2. 安装钱包合约，并默认注册用户A

   ```sh
   ./cmc client contract user create --admin-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.key --admin-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/admin1/admin1.tls.crt  --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --byte-code-path=../../test/wasm/asset-rust-0.7.2_v1.0.0.wasm --contract-name=asset_new_33 --runtime-type=WASMER --sdk-conf-path=../sdk/testdata/sdk_config.yml --version=1.0.0 --sync-result=true --params="{\"issue_limit\":\"1000\",\"total_supply\":\"100000000\"}"
   ```

3. 注册用户B

   ```sh
   ./cmc client contract user invoke  --contract-name=asset_new_33 --method=register --org-id=wx-org2.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.key --sdk-conf-path=../sdk/testdata/sdk_config.yml --sync-result=true
   ```

   

4. 查询用户A和B的账户地址

   ```sh
   ./cmc client contract user get  --contract-name=asset_new_33 --method=query_address --sdk-conf-path=../sdk/testdata/sdk_config.yml --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key
   
   ./cmc client contract user get  --contract-name=asset_new_33 --method=query_address --sdk-conf-path=../sdk/testdata/sdk_config.yml --org-id=wx-org2.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.key
   ```

   

5. 给两个客户端AB注册钱包分别发1000个币

   ```sh
   ./cmc client contract user invoke  --contract-name=asset_new_33 --method=issue_amount --sdk-conf-path=../sdk/testdata/sdk_config.yml --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --params="{\"amount\":\"1000\",\"to\":\"62c6a0672c28ae914e9c5100a2262762b0a5b7b13bf4b69b3beee92c51aefd0f\"}" --sync-result=true
   
   ./cmc client contract user invoke  --contract-name=asset_new_33 --method=issue_amount --sdk-conf-path=../sdk/testdata/sdk_config.yml --org-id=wx-org2.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org2.chainmaker.org/user/client1/client1.tls.key --params="{\"amount\":\"1000\",\"to\":\"c5d7d472124c988175beacef2b482206910c94845777eb3689af33e240c67129\"}" --sync-result=true
   ```

6. 将备用节点作为节点7的灾备节点

7. 杀掉节点7程序

8. 启用节点后的灾备节点

9. 使用用户A向灾备节点发送发送交易，调用转账合约，转账100个币给B，结果应为成功

   ```sh
   ./cmc client contract user invoke --contract-name=asset_new_33 --method=transfer --sdk-conf-path=../sdk/testdata/sdk_config.yml --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --params="{\"amount\":\"1000\",\"to\":\"c5d7d472124c988175beacef2b482206910c94845777eb3689af33e240c67129\"}" --sync-result=true
   ```

## 41 系统升级*

1. 使用0.7.2.1启动7节点双链，其中chain1有5节点，chain2有7节点

2. 持续获取链信息

   ```sh
   ./loop-chaininfo.sh
   ```

3. 查询单节点版本号，提示没有这个接口

   ```sh
   ./cmc client cmversion --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --sdk-conf-path=../sdk/testdata/sdk_config.yml
   ```

4. 逐个升级所有节点到0.7.2.2版本

   cp chainmaker ../build/release/chainmaker-V1.0.0-wx-org(X).chainmaker.org/bin，其中X为节点编号

5. 查询节点版本号到0.7.2.2版本

   ```sh
   ./cmc client cmversion --org-id=wx-org1.chainmaker.org --client-crt-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.crt --client-key-file-paths=../sdk/testdata/crypto-config/wx-org1.chainmaker.org/user/client1/client1.tls.key --sdk-conf-path=../sdk/testdata/sdk_config.yml
   ```

6. 查看第2步请求应都为成功