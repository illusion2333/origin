# 长安链 · ChainMaker Contract Manual

## 智能合约介绍

智能合约是一种计算机程序或交易协议，记录了交易条款信息、事件、行为，旨在减少对可信中间人的需求、仲裁和执行成本。在ChanMaker上，用户可以通过高级语言（C++、Go、Rust、JS）来编写智能合约，经过编译后，以WASM、EVM字节码的形式存储在区块链中。用户可以通过发送交易来触发执行智能合约中的代码。

## 智能合约SDK

用户通过高级语言编写的智能合约一般情况而言，都需要存取区块链上的数据、API支持，ChainMaker为不同的高级语言提供了不同的SDK。当然，这些SDK提供的基本能力是相同的，包括读取数据、写入数据、查询区块链的一些状态等。

不同语言的SDK受限于语言本身特性和编译器的支撑能力，比如go语言支持函数同时返回多个数据，而tinygo编译器对垃圾回收支持存在缺陷，加上区块链系统本身为智能合约提供的运行内存大小受限、调用栈深度受限，用户编写合约时，需要注意这些特性。

## 智能合约生命周期管理

### 合约部署

用户编写完成智能合约后，经过编译器编译为字节码，需要通过发送交易的形式部署到区块链上。发送的交易将被共识节点和同步节点接收和处理，在校验完成各项参数后，字节码将被存储在区块链数据库中。

在校验参数的过程中，如果下列校验出错，将把执行的错误信息记录在交易的执行结果中：

- 同一条链上不允许存在重名的合约
- 字节码不能为空
- 指定的智能合约执行引擎必须有效
- 版本信息不能为空

随后将调用执行合约的初始化方法：

- 对于WASM而言，将调用**init_contract()**方法，用户必须提供导出的**init_contract()**方法
- 对于EVM而言，将调用构造方法

### 合约升级

ChainMaker支持对基于WASM和EVM的字节码进行升级

- 对于WASM而言，将调用**upgrade()**方法，用户必须提供导出的**upgrade()**方法
- 对于EVM而言，并不会调用任何方法，只是单纯更新字节码

合约升级也同样需要校验参数，如果下列校验出错，将把执行的错误信息记录在交易的执行结果中：

- 合约必须已经被部署成功
- 字节码不能为空
- 版本信息不能为空

### 合约冻结

如果用户需要对已经部署在ChainMaker的智能合约进行冻结操作，需要发送冻结类型的交易，并指定合约名称，就可以冻结合约。被冻结的合约不允许被用户调用执行。

### 合约解冻

用户也可以解冻已经被冻结的合约。

### 合约注销





## 智能合约Sample

### 存证

go

rust

C++

### 转账

go

rust

C++



## 在线IDE

使用说明

IDE部署，后续提供

基于IDE的发布能力待工具完善后补充











